
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Accessing the cluster Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../exercise-2/" />
    
    
    <link rel="prev" href="../exercise-0/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Workshop
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../GETSTARTED.html">
            
                <a href="../GETSTARTED.html">
            
                    
                    Create account and get cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../exercise-0/">
            
                <a href="../exercise-0/">
            
                    
                    Setup CLI Access for the cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.1.3" data-path="./">
            
                <a href="./">
            
                    
                    Accessing the cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="../exercise-2/">
            
                <a href="../exercise-2/">
            
                    
                    Using OpenShift
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="../exercise-3/">
            
                <a href="../exercise-3/">
            
                    
                    Deploy Example Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6" data-path="../exercise-4/">
            
                <a href="../exercise-4/">
            
                    
                    Metrics and tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7" data-path="../exercise-4b/README.md">
            
                <span>
            
                    
                    Monitoring (Optional)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.8" data-path="../exercise-5/">
            
                <a href="../exercise-5/">
            
                    
                    Storage and Networking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.9" data-path="../exercise-6/">
            
                <a href="../exercise-6/">
            
                    
                    Advanced Features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.10" data-path="../exercise-7/README.md">
            
                <span>
            
                    
                    Runtime Security with Falco
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <a target="_blank" href="https://cognitiveclass.ai/courses/beyond-the-basics-istio-and-ibm-cloud-kubernetes-service/">
            
                    
                    Certification
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Accessing the cluster</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="exercise-1-using-openshift">Exercise 1: Using OpenShift</h1>
<p>In this exercise, you&apos;ll deploy a simple Node.js Express application - &quot;Example Health&quot;. Example Health is a simple UI for a patient health records system. We&apos;ll use this example to demonstrate key OpenShift features throughout this workshop. You can find the sample application GitHub repository here: <a href="https://github.com/IBM/node-s2i-openshift" target="_blank">https://github.com/IBM/node-s2i-openshift</a></p>
<h2 id="deploy-example-health">Deploy Example Health</h2>
<p>Access your cluster on the <a href="https://cloud.ibm.com/kubernetes/clusters" target="_blank">IBM Cloud clusters dashboard</a>. Click the <code>OpenShift web console</code> button on the top-right. (This is a pop-up so you&apos;ll need to white list this site.)</p>
<p>Create a project, you can title it whatever you like, we suggest &quot;example-health.&quot;</p>
<p><img src="../.gitbook/assets/createproject.png" alt="Create Project"></p>
<p>Click on your new project. You should see a view that looks like this:</p>
<p><img src="../.gitbook/assets/projectview.png" alt="Project View"></p>
<p>Click on the browse catalog button and scroll down to the <code>Node.js</code> image. Click on that catalog button.</p>
<p><img src="../.gitbook/assets/node.png" alt="Node"></p>
<p>Click through to the second step for configuration, and choose <code>advanced options</code>. ( a blue hyperlink on the bottom line )</p>
<p><img src="../.gitbook/assets/advanced.png" alt="Advanced"></p>
<p>You&apos;ll see an advanced form like this:</p>
<p><img src="../.gitbook/assets/node-advanced-form.png" alt="Node Advanced Form"></p>
<p>Enter the repository: <code>https://github.com/IBM/node-s2i-openshift</code> and <code>/site</code> for the &apos;Context Dir&apos;. Click &apos;Create&apos; at the bottom of the window to build and deploy the application.</p>
<p>Scroll through to watch the build deploying:</p>
<p><img src="../.gitbook/assets/build.png" alt="Build"></p>
<p>When the build has deployed, click the &apos;External Traffic Route&apos;, and you should see the login screen like the following:</p>
<p><img src="../.gitbook/assets/login.png" alt="Login"></p>
<p>You can enter any strings for username and password, for instance <code>test:test</code> because the app is running in demo mode.</p>
<p>Congrats! You&apos;ve deployed a <code>Node.js</code> app to Kubernetes using OpenShift Source-to-Image (S2I).</p>
<h2 id="understanding-what-happened">Understanding What Happened</h2>
<p><a href="https://docs.openshift.com/container-platform/3.6/architecture/core_concepts/builds_and_image_streams.html#source-build" target="_blank">S2I</a> is a framework that creates container images from source code, then runs the assembled images as a containers. It allows developers to build reproducible images easily, letting them spend time on what matters most, developing their code!</p>
<h2 id="git-webhooks">Git Webhooks</h2>
<p>So far we have been doing alot of manual deployment. In cloud-native world we want to move away from manual work and move toward automation. Wouldn&apos;t it be nice if our application rebuilt on git push events? Git webhooks are the way its done and openshift comes bundled in with git webhooks. Let&apos;s set it up for our project.</p>
<p>To be able to setup git webhook we need to have elevated permission to the project. The repo we have been using so far we don&apos;t own it. But since its opensource we can easily fork it and make it our own.</p>
<p>Fork the repo at <a href="https://github.com/IBM/node-s2i-openshift" target="_blank">https://github.com/IBM/node-s2i-openshift</a></p>
<p><img src="../.gitbook/assets/fork.png" alt="Fork"></p>
<p>Now that I have forked the repo under my repo I have full admin priviledges. As you can see I now have a settings button that I can change the repo settings with.</p>
<p><img src="../.gitbook/assets/forked-repo.png" alt="Forked Repo"></p>
<p>We will come back to this page in a moment. Lets change our git source to our repo.</p>
<p>From our openshift dashboard for our project. Select <code>Builds &gt; Builds</code></p>
<p><img src="../.gitbook/assets/goto-build.png" alt="Goto Build"></p>
<p>Select the patientui build. As of now this should be the only build on screen.</p>
<p><img src="../.gitbook/assets/select-build.png" alt="Select Build"></p>
<p>Click on <code>Action</code> on the right and then select <code>Edit</code></p>
<p><img src="../.gitbook/assets/edit-build.png" alt="Edit Build"></p>
<p>Change the <code>Git Repository URL</code> to our forked repository.</p>
<p>Click Save in the bottom.</p>
<p><img src="../.gitbook/assets/update-build-src.png" alt="Update Build"></p>
<p>You will see this will not result in a new build. If you want to start a manual build you can do so by clicking <code>Start Build</code>. We will skip this for now and move on to the webhook part.</p>
<p>Click on <code>Configuration</code> tab.</p>
<p>Copy the GitHub Webook URL.</p>
<p>The webhook is in the structure</p>
<pre><code class="lang-text">https://c100-e.us-east.containers.cloud.ibm.com:31305/apis/build.openshift.io/v1/namespaces/example-health/buildconfigs/patientui/webhooks/&lt;secret&gt;/github
</code></pre>
<p>Make note of the secret. (Its the Alpha-Numeric string between <code>webhooks</code> and <code>github</code>) We will need it in the next step.</p>
<p><img src="../.gitbook/assets/copy-github-webhook.png" alt="Copy github webhook"></p>
<blockquote>
<p>There is also the generic webhook url. This also works for github. But the github webhook captures some additional data from github and is more specific. But if we were using some other git repo like bitbucket or gitlab we would use the generic one.</p>
</blockquote>
<p>In our github repo go to <code>Setting &gt; Webhooks</code>. Then click <code>Add Webhook</code></p>
<p><img src="../.gitbook/assets/webhook-page.png" alt="webhook page"></p>
<p>In the Add Webhook page fill in the <code>Payload URL</code> with the url copied earlier from the build configuration. Change the <code>Content type</code> to <code>application/json</code> and fill in the secret.</p>
<p>Right now just the push event is being sent which is fine for our use.</p>
<p>Click on <code>Add webhook</code></p>
<p><img src="../.gitbook/assets/add-webhook.png" alt="add webhook"></p>
<p>If the webhook is reachable by github you will see a green check mark.</p>
<p>Back in our openshift console we still would only see one build however. Because we added a webhook that sends us push events and we have no push event happening. Lets make one. The easiest way to do it is probably from the Github UI. Lets change some text in the login page.</p>
<p>Path to this file is <code>site/public/login.html</code> from the root of the directory. On Github you can edit any file by clicking the Pencil icon on the top right corner.</p>
<p><img src="../.gitbook/assets/edit-page.png" alt="edit page"></p>
<p>Let&apos;s change the name our application to <code>Demo Health</code> (Line 21, Line 22). Feel free to make any other UI changes you feel like.</p>
<p><img src="../.gitbook/assets/changes.png" alt="changes"></p>
<p>Once done go to the bottom and click <code>commit changes</code>.</p>
<p>Go to the openshift build page again. This happens quite fast so you might not see the running state. But the moment we made that commit a build was kicked off.</p>
<p><img src="../.gitbook/assets/running-build.png" alt="running build"></p>
<p>In a moment it will show completed. Navigate to the overview page to find the route.</p>
<p><img src="../.gitbook/assets/route.png" alt="route"></p>
<blockquote>
<p>You could also go to <code>Applications &gt; Routes</code> to find the route for the application.</p>
</blockquote>
<p>If you go to your new route you will see your change.</p>
<p><img src="../.gitbook/assets/updated-ui.png" alt="UI"></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../exercise-0/" class="navigation navigation-prev " aria-label="Previous page: Setup CLI Access for the cluster">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../exercise-2/" class="navigation navigation-next " aria-label="Next page: Using OpenShift">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Accessing the cluster","level":"1.1.3","depth":2,"next":{"title":"Using OpenShift","level":"1.1.4","depth":2,"path":"exercise-2/README.md","ref":"exercise-2/README.md","articles":[]},"previous":{"title":"Setup CLI Access for the cluster","level":"1.1.2","depth":2,"path":"exercise-0/README.md","ref":"exercise-0/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["hints"],"root":"./workshop","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"hints":{"info":"fa fa-info-circle","tip":"fa fa-mortar-board","danger":"fa fa-exclamation-circle","working":"fa fa-wrench"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"exercise-1/README.md","mtime":"2019-09-06T16:54:43.798Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-09-06T16:55:36.892Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>


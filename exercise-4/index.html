
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Exercise 4: Autoscale Pods Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../exercise-5/" />
    
    
    <link rel="prev" href="../exercise-3/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Workshop
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../GETSTARTED.html">
            
                <a href="../GETSTARTED.html">
            
                    
                    Create account and get cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../exercise-0/">
            
                <a href="../exercise-0/">
            
                    
                    Setup CLI Access for the cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="../exercise-1/">
            
                <a href="../exercise-1/">
            
                    
                    Exercise 1: Using OpenShift
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="../exercise-2/">
            
                <a href="../exercise-2/">
            
                    
                    Exercise 2: Logging and Monitoring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="../exercise-3/">
            
                <a href="../exercise-3/">
            
                    
                    Exercise 3: Metrics and Dashboards
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.1.6" data-path="./">
            
                <a href="./">
            
                    
                    Exercise 4: Autoscale Pods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7" data-path="../exercise-5/">
            
                <a href="../exercise-5/">
            
                    
                    Exercise 5: Liveness and Readiness Probes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.8" data-path="../exercise-7/README.md">
            
                <span>
            
                    
                    TODO: Runtime Security with Falco
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <a target="_blank" href="https://cognitiveclass.ai/courses/beyond-the-basics-istio-and-ibm-cloud-kubernetes-service/">
            
                    
                    Certification
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Exercise 4: Autoscale Pods</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="exercise-4-autoscale-pods">Exercise 4: Autoscale Pods</h1>
<p>In this exercise, we&apos;ll leverage the metrics we&apos;ve observed in the previous step to automatically scale our UI application in response to load.</p>
<h2 id="enable-resource-limits">Enable Resource Limits</h2>
<p>Before we can setup autoscaling for our pods, we first need to set resource limits on the pods running in our cluster. Limits allows you to choose the minimum and maximum CPU and memory usage for a pod.</p>
<p>Navigate to <code>Applications &gt; Deployments</code>, then choose your deployment. Then, choose <code>Actions &gt; Edit Resource Limits</code>.</p>
<p><img src="../.gitbook/assets/edit-resource-limit-step.png" alt="Add Resource Limits"></p>
<p>Hopefully you have your running script simulating load (if not go <a href="../exercise-2/#simulate-load-on-the-application">here</a>),
Grafana showed you that your application was consuming anywhere between &quot;.002&quot; to
&quot;.02&quot; cores. This translates to 2-20 &quot;millicores&quot;. That seems like a good range for
our CPU request, but to be safe, let&apos;s bump the higher-end up to 30 millicores. In
addition, Grafana showed that the app consumes about <code>25</code>-<code>35</code> MB of RAM. Set the
following resource limits for your deployment now.</p>
<p><img src="../.gitbook/assets/resource-limit-ui.png" alt="Recommended Resource Limits"></p>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>Remember to set the correct unit -- millicores and MB (not MiB)</p>
</div></div></p>
<p>Hit save. If there&apos;s an error saying that the deployment has changed, you may need to go back to your deployment, refersh the page, and try again.</p>
<h2 id="enable-autoscaler">Enable Autoscaler</h2>
<p>Now that we have resource limits, let&apos;s enable autoscaler. Go back to the deployment, but this time choose <code>Actions &gt; Edit Autoscaler</code>.</p>
<p><img src="../.gitbook/assets/edit-auto-scaler%20%281%29.png" alt="Edit Autoscaler"></p>
<p>By default, the autoscaler allows you to scale based on CPU or Memory. The UI allows
you to do CPU only (for now). Pods are balanced between the minimum and maximum
number of pods that you specify. With the autoscaler, pods are automatically created
or deleted to ensure that the average CPU usage of the pods is below the CPU request
target as defined. In general, you probably want to start scaling up when you get near
<code>50</code>-<code>90</code>% of the CPU usage of a pod. In our case, let&apos;s make it <code>1</code>% to test the autoscaler
since we are generating minimal load.</p>
<p><img src="../.gitbook/assets/autoscale-deployment-config-ui.png" alt="Autoscaler Recommended Values"></p>
<p>Click <code>Save</code>.</p>
<h2 id="test-autoscaler">Test Autoscaler</h2>
<p>If you&apos;re not running the script from the <a href="exercise-2.md#simulate-load-on-the-application">previous exercise</a>, the pods should stay at 1. Check by going to the overview page.</p>
<p><img src="../.gitbook/assets/before-scale.png" alt="Scaled to 1 pod"></p>
<p>Start simulating load by hitting the page several times, or running the script. You&apos;ll see that it starts to scale up:</p>
<p><img src="../.gitbook/assets/scaling.png" alt="Scaled to 4/10 pods"></p>
<p>That&apos;s it! You now have a highly available and automatically scaled front-end Node.js application. OpenShift is automatically scaling your application pods since the CPU usage of the pods greatly exceeded <code>1</code>% of the resource limit, <code>30</code> millicores.</p>
<h3 id="optional">Optional</h3>
<p>Find the Autoscaler information in the Deployment.</p>
<p><img src="../.gitbook/assets/autoscaling.png" alt="Autoscaler Deployment"></p>
<p>If you&apos;re interested in setting up the CLI, <a href="exercise-1.md">follow the steps here</a>. Then, run the following command in your CLI <code>oc get hpa</code> to get information about your horizontal pod autoscaler. Remember to switch to your project first with <code>oc project &lt;project-name&gt;</code>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../exercise-3/" class="navigation navigation-prev " aria-label="Previous page: Exercise 3: Metrics and Dashboards">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../exercise-5/" class="navigation navigation-next " aria-label="Next page: Exercise 5: Liveness and Readiness Probes">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Exercise 4: Autoscale Pods","level":"1.1.6","depth":2,"next":{"title":"Exercise 5: Liveness and Readiness Probes","level":"1.1.7","depth":2,"path":"exercise-5/README.md","ref":"exercise-5/README.md","articles":[]},"previous":{"title":"Exercise 3: Metrics and Dashboards","level":"1.1.5","depth":2,"path":"exercise-3/README.md","ref":"exercise-3/README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["hints"],"root":"./workshop","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"hints":{"info":"fa fa-info-circle","tip":"fa fa-mortar-board","danger":"fa fa-exclamation-circle","working":"fa fa-wrench"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"exercise-4/README.md","mtime":"2019-09-06T18:14:17.586Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-09-06T18:15:03.871Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

